name: Claude Code Auto Reply

on:
  issues:
    types: [opened, edited]

jobs:
  auto-reply:
    if: contains(github.event.issue.labels.*.name, 'ask-codex')
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Claude Code Auto Response
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const issueBody = context.payload.issue.body;
          const issueTitle = context.payload.issue.title;
          
          // 定型的な回答メッセージ
          const replyMessage = `
          ## 🤖 Claude Code AI による自動回答
          
          ご質問ありがとうございます。現在、以下の情報に基づいて回答を準備中です：
          
          **質問タイトル**: ${issueTitle}
          
          ### 📋 次のステップ
          1. 関連するコードファイルと要件定義を分析
          2. 技術的な実装アプローチを検討  
          3. C# / WPF / MVVM パターンに基づく回答を生成
          4. テスト可能な実装例を提供
          
          ### ⏱️ 予想回答時間
          通常 5-10 分以内に詳細な技術回答をコメントで提供します。
          
          ### 📚 参考リソース
          - [要件定義 v3.3](../docs/requirement.md)
          - [アーキテクチャ設計](../docs/architecture.md)
          - [開発計画](../development_plan.md)
          
          ---
          *このメッセージは GitHub Actions により自動生成されました*
          `;
          
          // Issue にコメントを追加
          await github.rest.issues.createComment({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: context.issue.number,
            body: replyMessage
          });
          
          // ラベルを追加
          await github.rest.issues.addLabels({
            owner: context.repo.owner,
            repo: context.repo.repo, 
            issue_number: context.issue.number,
            labels: ['ai-processing']
          });