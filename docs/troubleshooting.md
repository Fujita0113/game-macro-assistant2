# トラブルシューティングガイド

## 既知の制限事項

### DPIスケーリング関連 (R-022)

**問題**: 100%以外のDPIスケーリング環境で座標がずれる

**原因**: Windows の論理座標と物理座標の差異

**対処法**:
1. アプリを「高DPI対応」で実行
2. 設定で「DPI補正」を有効化
3. 記録時と再生時で同じDPIスケール使用

**座標変換アルゴリズム** (擬似コード):
```
physicalX = logicalX * (systemDPI / 96.0)
physicalY = logicalY * (systemDPI / 96.0)

// リバース変換
logicalX = physicalX / (systemDPI / 96.0)  
logicalY = physicalY / (systemDPI / 96.0)
```

## よくある問題

### 1. マクロ記録ができない

**症状**: 記録ボタンを押しても反応しない

**原因と対処**:
- **管理者権限不足**: アプリを管理者として実行
- **セキュリティソフト**: Windows Defender等でブロック解除
- **他のマクロツール競合**: 同時実行を避ける

### 2. 画像認識が失敗する

**症状**: 条件画像が見つからずタイムアウト

**原因と対処**:
- **閾値調整**: 設定でSSIM/ピクセル差分を緩める
- **解像度変更**: 記録時と異なる解像度で実行
- **画面更新**: ゲーム側でVSync等による表示遅延

### 3. パフォーマンス問題

**症状**: CPU使用率・メモリ使用量が高い

**原因と対処**:
- **キャプチャ頻度**: フレームレート制限を有効化
- **メモリリーク**: アプリ再起動、タスクマネージャで確認
- **バックグラウンドプロセス**: 不要なアプリを終了

### 4. ホットキーが効かない

**症状**: グローバルホットキーでマクロが起動しない

**原因と対処**:
- **キー競合**: 設定で別のキー組み合わせに変更
- **アプリフォーカス**: 管理者権限のアプリが前面にある
- **キーボードフック失敗**: アプリ再起動

## エラーコード一覧

| コード | 意味 | 対処法 |
|--------|------|--------|
| Err-CAP | 画面キャプチャ失敗 | Desktop Duplication API → GDI フォールバック |
| Err-TIM | 再生タイミング誤差超過 | システム負荷を下げる |
| Err-IMG | 画像認識失敗 | 閾値調整・条件画像再設定 |
| Err-KEY | キーボードフック失敗 | 管理者権限・競合アプリ確認 |
| Err-FILE | ファイル読み書き失敗 | パス確認・権限確認 |

## ログ出力場所

- **アプリケーションログ**: `%APPDATA%\GameMacroAssistant\Logs\YYYY-MM-DD.log`
- **クラッシュダンプ**: `%LOCALAPPDATA%\GameMacroAssistant\CrashDumps\`
- **設定ファイル**: `%APPDATA%\GameMacroAssistant\settings.json`

## サポート情報

**GitHub Issues**: [リンク未定]
**Wiki**: [リンク未定]  
**FAQ**: [リンク未定]

## 開発者向け情報

**デバッグビルド実行**:
```powershell
dotnet run --project src/GameMacroAssistant.Wpf --configuration Debug
```

**ログレベル変更**:
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Debug"
    }
  }
}
```