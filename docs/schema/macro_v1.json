{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://gamemacroassistant.dev/schema/macro_v1.json",
  "title": "GameMacroAssistant Macro File Schema v1",
  "description": "Schema for .gma.json macro files",
  "type": "object",
  "required": ["version", "metadata", "steps"],
  "properties": {
    "version": {
      "type": "string",
      "enum": ["1.0"],
      "description": "Schema version"
    },
    "metadata": {
      "type": "object",
      "required": ["name", "created", "modified"],
      "properties": {
        "name": {
          "type": "string",
          "maxLength": 255,
          "description": "Macro display name"
        },
        "description": {
          "type": "string",
          "maxLength": 1000,
          "description": "Optional macro description"
        },
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "Creation timestamp (ISO 8601)"
        },
        "modified": {
          "type": "string", 
          "format": "date-time",
          "description": "Last modification timestamp (ISO 8601)"
        },
        "encrypted": {
          "type": "boolean",
          "default": false,
          "description": "Whether the macro is encrypted with passphrase"
        }
      }
    },
    "steps": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/MacroStep"
      },
      "description": "Array of macro steps"
    }
  },
  "definitions": {
    "MacroStep": {
      "type": "object",
      "required": ["id", "type", "timestamp"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique step identifier"
        },
        "type": {
          "type": "string",
          "enum": ["mouse", "keyboard", "image", "delay", "comment"],
          "description": "Step type"
        },
        "timestamp": {
          "type": "integer",
          "minimum": 0,
          "description": "Relative timestamp in milliseconds"
        },
        "data": {
          "oneOf": [
            {"$ref": "#/definitions/MouseData"},
            {"$ref": "#/definitions/KeyboardData"}, 
            {"$ref": "#/definitions/ImageData"},
            {"$ref": "#/definitions/DelayData"},
            {"$ref": "#/definitions/CommentData"}
          ]
        }
      }
    },
    "MouseData": {
      "type": "object",
      "required": ["x", "y", "button", "action"],
      "properties": {
        "x": {"type": "integer", "minimum": 0},
        "y": {"type": "integer", "minimum": 0},
        "button": {
          "type": "string",
          "enum": ["left", "right", "middle", "x1", "x2"]
        },
        "action": {
          "type": "string", 
          "enum": ["down", "up", "click", "move"]
        }
      }
    },
    "KeyboardData": {
      "type": "object",
      "required": ["virtualKey", "action"],
      "properties": {
        "virtualKey": {
          "type": "integer",
          "minimum": 1,
          "maximum": 255
        },
        "action": {
          "type": "string",
          "enum": ["down", "up", "press"]
        },
        "modifiers": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["ctrl", "alt", "shift", "win"]
          }
        }
      }
    },
    "ImageData": {
      "type": "object", 
      "required": ["template", "region"],
      "properties": {
        "template": {
          "type": "string",
          "description": "Base64 encoded PNG image"
        },
        "region": {
          "type": "object",
          "required": ["x", "y", "width", "height"],
          "properties": {
            "x": {"type": "integer", "minimum": 0},
            "y": {"type": "integer", "minimum": 0},
            "width": {"type": "integer", "minimum": 1},
            "height": {"type": "integer", "minimum": 1}
          }
        },
        "threshold": {
          "type": "object",
          "properties": {
            "ssim": {"type": "number", "minimum": 0, "maximum": 1},
            "pixelDiff": {"type": "number", "minimum": 0, "maximum": 1}
          }
        }
      }
    },
    "DelayData": {
      "type": "object",
      "required": ["duration"],
      "properties": {
        "duration": {
          "type": "integer",
          "minimum": 1,
          "description": "Delay duration in milliseconds"
        }
      }
    },
    "CommentData": {
      "type": "object",
      "required": ["text"],
      "properties": {
        "text": {
          "type": "string",
          "maxLength": 500,
          "description": "Comment text"
        }
      }
    }
  }
}